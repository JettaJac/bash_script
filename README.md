# LinuxMonitoring - Bash script project
##

Учебный проект по мониторингу и исследованию состояния системы Linux в реальном времени.

##
## Contents

1. [Chapter I - Обзор](#chapter-i) \
    1.1. [Генератор файлов](#part-1-генератор-файлов)  
    1.2. [Засорение файловой системы](#part-1-засорение-файловой-системы)  
    1.3. [Очистка файловой системы](#part-3-очистка-файловой-системы)  
    1.4. [Генератор логов](#part-4-генератор-логов)  
    1.5. [Мониторинг](#part-5-мониторинг)  
    1.6. [GoAccess](#part-6-goaccess)  
    1.7. [Prometheus и Grafana](#part-7-prometheus-и-grafana)  
    1.8. [Готовый дашборд](#part-8-готовый-дашборд)  
    1.9. [Дополнительно. Свой node_exporter](#part-9-дополнительно-свой-node_exporter)  
2. [Chapter II - Краткая информация](#chapter-ii) \


#
##
## Обзор
В каждой папке находиться скрипт выполняющий ряд задач по мониторингу системы 

#

## Part 1. Генератор файлов

Bash-скрипт, который создает определенное количество папок и файлов по определенному пути. Скрипт запускается с 6 параметрами. 
**Параметр 1** - это абсолютный путь. \
**Параметр 2** - количество вложенных папок. \
**Параметр 3** - список букв английского алфавита, используемый в названии папок (не более 7 знаков). \
**Параметр 4** - количество файлов в каждой созданной папке. \
**Параметр 5** - список букв английского алфавита, используемый в имени файла и расширении (не более 7 знаков для имени, не более 3 знаков для расширения). \
**Параметр 6** - размер файлов (в килобайтах, но не более 100).  

При запуске скрипта в указанном в параметре 1 месте, создаются папки и файлы в них с соответствующими именами и размером.  
Скрипт остановливает работу, если в файловой системе (в разделе /) останется 1 Гб свободного места.  
Записывается лог-файл с данными по всем созданным папкам и файлам (полный путь, дата создания, размер для файлов).
##
**Запуска скрипта:**  \
`sh main.sh /opt/test 4 az 5 az.az 3kb` 


#
## Part 2. Засорение файловой системы

Bash-скрипт, который создает файлы и папки с определенными параметрами. Скрипт запускается с 3 параметрами. \
**Параметр 1** - список букв английского алфавита, используемый в названии папок (не более 7 знаков). \
**Параметр 2** - список букв английского алфавита, используемый в имени файла и расширении (не более 7 знаков для имени, не более 3 знаков для расширения). \
**Параметр 3** - размер файла (в Мегабайтах, но не более 100). 

При запуске скрипта, в различных (любых, кроме путей содержащих **bin** или **sbin**) местах файловой системы, создаются папки с файлами.
Количество вложенных папок - до 100. Количество файлов в каждой папке - случайное число (для каждой папки своё).  
Скрипт остановливает работу, если в файловой системе (в разделе /) останется 1 Гб свободного места.  
Записывается лог-файл с данными по всем созданным папкам и файлам (полный путь, дата создания, размер для файлов).  

**Запуска скрипта:**  \
`sh main.sh az az.az 3Mb`

#
## Part 3. Очистка файловой системы

Скрипт очищает систему от созданных в [Part 2](#part-2-засорение-файловой-системы) папок и файлов 3 способами: \
1. По лог файлу
2. По дате и времени создания
3. По маске имени (т.е. символы, нижнее подчёркивание и дата).  

Способ очистки задается при запуске скрипта, как параметр со значением 1, 2 или 3.

**Запуска скрипта:**  \
`sh main.sh 1`

#
## Part 4. Генератор логов

Bash-скрипт генерирует 5 файлов логов **nginx** в *combined* формате.
Каждый лог содержит информацию за 1 день.

За день скрипт генерирует случайное число записей от 100 до 1000.
Для каждой записи случайным образом генерируется:
1. IP (любые корректные, т.е. не должно быть ip вида 999.111.777.777)
2. Коды ответа (200, 201, 400, 401, 403, 404, 500, 501, 502, 503)
3. Методы (GET, POST, PUT, PATCH, DELETE)
4. Даты (в рамках заданного дня лога, должны идти по увеличению)
5. URL запроса агента
6. Агенты (Mozilla, Google Chrome, Opera, Safari, Internet Explorer, Microsoft Edge, Crawler and bot, Library and net tool)

**Запуска скрипта:**  \
`sh main.sh`

#
## Part 5. Мониторинг

Bash-скрипт для разбора логов **nginx** из [Части 4](#part-4-генератор-логов) через **awk**.

Скрипт запускается с 1 параметром, который принимает значение 1, 2, 3 или 4.
В зависимости от значения параметра вывести:

1. Все записи, отсортированные по коду ответа
2. Все уникальные IP, встречающиеся в записях
3. Все запросы с ошибками (код ответа - 4хх или 5хх)
4. Все уникальные IP, которые встречаются среди ошибочных запросов

**Запуска скрипта:**  \
`sh main.sh 1`

#
## Part 6. **GoAccess**

С помощью утилиты GoAccess получаем ту же информацию, что и в [Части 5](#part-5-мониторинг)

Открыть веб интерфейс утилиты на локальной машине.

**Запуска скрипта:**  \
`sh main.sh`

#
## Part 7. **Prometheus** и **Grafana**

Устанавливаем и настраиваем **Prometheus** и **Grafana** на виртуальную машину. Получение доступ к веб интерфейсам **Prometheus** и **Grafana** с локальной машины

Н а дашборд **Grafana** отображается ЦПУ, доступной оперативной памяти, свободное место и кол-во операций ввода/вывода на жестком диске

Для тестирования, запускаем bash-скрипт из [Части 2](#part-2-засорение-файловой-системы)
а также через утилу  **stress** и запустить команду `stress -c 2 -i 1 -m 1 --vm-bytes 32M -t 10s`

**Запуска скрипта:**  \
`sh main.sh`


#
## Part 8. Готовый дашборд

Тестим готовый дашборд *Node Exporter Quickstart and Dashboard* с официального сайта **Grafana Labs**, что и в [Части 7](#part-7-prometheus-и-grafana)

**Запуска скрипта:**  \
`sh main.sh`
#
## Part 9. Дополнительно. Свой *node_exporter*

Bash-скрипт собирает информацию по базовым метрикам системы (ЦПУ, оперативная память, жесткий диск (объем).
Скрипт формирует html страничку по формату **Prometheus**, которую будет отдавать **nginx**. \

**Запуска скрипта:**  \
`sh main.sh` 


#
##
## Технологический стек

- Язык программирования: Bash
- Операционная система: Ubuntu Server 20.04 LTS



#
#
#
#
## Chapter II - Краткая информация

### **GoAccess**

GoAccess - это анализатор логов, который может работать с ними в реальном времени, визуализировать информаию и отдавать ее через терминал или через браузер в виде веб-странички. 

### **Prometheus**

Базы данных временных рядов, как следует из их названия, представляют собой системы баз данных,
специально разработанные для обработки данных, связанных со временем.

Большинство систем использует реляционные базы данных, основанные на таблицах. 
Базы данных временных рядов работают по-другому.
Данные по-прежнему хранятся в "коллекциях", но эти коллекции имеют общий знаменатель: они агрегируются с течением времени.
По сути, это означает, что для каждой точки, которую можно сохранить, есть связанная с ней метка времени.

Prometheus — это база данных временных рядов, к которой можно присоединить целую экосистему инструментов, чтобы расширить ее функционал. \
Prometheus создан, чтобы мониторить самые разные системы: серверы, базы данных, отдельные виртуальные машины, да почти что угодно.

### **Grafana**

Grafana — платформа для визуализации, мониторинга и анализа данных.
Grafana позволяет пользователям создавать *дашборды* с *панелями*, каждая из которых отображает определенные показатели в течение установленного периода времени.
Каждый *дашборд* универсален, поэтому его можно настроить для конкретного проекта.

*Панель* — базовый элемент визуализации выбранных показателей.

*Дашборд* — набор отдельных панелей, размещенных в сетке с набором переменных (например, имя сервера, приложения и т.д.).